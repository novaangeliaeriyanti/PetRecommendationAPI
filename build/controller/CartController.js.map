{"version":3,"sources":["../../server/controller/CartController.js"],"names":["isCartOpen","req","res","next","user_id","prod_id","price","qty","body","result","context","models","cart","findOrCreate","where","cart_user_id","parseInt","cart_status","defaults","cart_created_on","Date","carts","dataValues","product","error","status","json","message","saveLineItem","line_items","lite_cart_id","cart_id","lite_prod_id","lite_price","parseFloat","lite_qty","lite_subtotal","lite_status","lite_order_name","update","returning","send","checkout","cartId","checkoutMultiple","j","length","updateItems","order_name","updateCart","findOne","summaryCart","findAll","lineItems","totalQty","reduce","total","el","subTotal","summary","findAllRows"],"mappings":"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","sourcesContent":["const isCartOpen = async (req, res, next) => {\n  const { user_id, prod_id, price, qty } = req.body;\n  try {\n    const result = await req.context.models.cart.findOrCreate({\n      where: { cart_user_id: parseInt(user_id), cart_status: \"OPEN\" },\n      defaults: {\n        cart_created_on: new Date(),\n        cart_status: \"OPEN\",\n        cart_user_id: user_id,\n      },\n    });\n\n    req.carts = {\n      cart: result[0].dataValues,\n      product: { prod_id, price, qty },\n    };\n\n    next();\n  } catch (error) {\n    res.status(404).json({ message: error.message });\n  }\n};\n\nconst saveLineItem = async (req, res) => {\n  const { cart, product } = req.carts;\n  // create product\n  try {\n    const result = await req.context.models.line_items.findOrCreate({\n      where: { lite_cart_id: cart.cart_id, lite_prod_id: product.prod_id },\n      defaults: {\n        lite_cart_id: parseInt(cart.cart_id),\n        lite_prod_id: parseInt(product.prod_id),\n        lite_price: parseFloat(product.price),\n        lite_qty: parseInt(product.qty),\n        lite_subtotal: parseInt(product.qty) * parseFloat(product.price),\n        lite_status: \"OPEN\",\n        lite_order_name: null,\n      },\n    });\n\n    //update product if data already exist\n    if (result[1] === false) {\n      try {\n        await req.context.models.line_items.update(\n          {\n            lite_price: parseFloat(product.price),\n            lite_qty: parseInt(product.qty),\n            lite_subtotal: parseInt(product.qty) * parseFloat(product.price),\n          },\n          {\n            returning: true,\n            where: {\n              lite_cart_id: cart.cart_id,\n              lite_prod_id: product.prod_id,\n            },\n          }\n        );\n        res.send({ message: \"cart has been update\" });\n      } catch (error) {\n        res.status(404).json({ message: error.message });\n      }\n    } else {\n      res.send({ message: \"cart has been add\" });\n    }\n  } catch (error) {\n    res.status(404).json({ message: error.message });\n  }\n};\n\nconst checkout = async (req, res, next) => {\n  const { cart_id, prod_id, price, qty } = req.body;\n  try {\n    await req.context.models.line_items.update(\n      {\n        lite_price: parseFloat(price),\n        lite_qty: parseInt(qty),\n        lite_subtotal: parseInt(qty) * parseFloat(price),\n        lite_status: \"CHECKOUT\",\n      },\n      {\n        returning: true,\n        where: { lite_cart_id: cart_id, lite_prod_id: prod_id },\n      }\n    );\n    req.status = \"CHECKOUT\";\n    req.cartId = cart_id;\n    next();\n  } catch (error) {\n    res.status(404).json({ message: error.message });\n  }\n};\n\nconst checkoutMultiple = async (req, res, next) => {\n  const { cart_id, product } = req.body;\n  try {\n    //const result= product[1].qty;\n    for (let j = 0; j < product.length; j++) {\n      await req.context.models.line_items.update(\n        {\n          lite_price: parseFloat(product[j].price),\n          lite_qty: parseInt(product[j].qty),\n          lite_subtotal:\n            parseInt(product[j].qty) * parseFloat(product[j].price),\n          lite_status: \"CHECKOUT\",\n        },\n        {\n          returning: true,\n          where: {\n            lite_cart_id: cart_id,\n            lite_prod_id: parseInt(product[j].prod_id),\n          },\n        }\n      );\n    }\n    req.status = \"CHECKOUT\";\n    req.cartId = cart_id;\n    next();\n  } catch (error) {\n    return res.status(404).json({ message: error.message });\n  }\n};\n\nconst updateItems = async (req, res, next) => {\n  const { cart_id } = req.body;\n  const order_name = req.order_name;\n  const lite_status = req.status;\n  try {\n    await req.context.models.line_items.update(\n      {\n        lite_order_name: order_name,\n        lite_status: lite_status,\n      },\n      {\n        returning: true,\n        where: { lite_cart_id: parseInt(cart_id), lite_status: \"CHECKOUT\" },\n      }\n    );\n    next();\n  } catch (error) {\n    res.status(404).json({ message: error.message });\n  }\n};\n\nconst updateCart = async (req, res) => {\n  const { cart_id } = req.body;\n  const cart_status = req.status;\n  //update cart status\n  try {\n    const result = await req.context.models.cart.findOne({\n      where: { cart_id: cart_id },\n    });\n\n    if (result.dataValues.cart_status === \"OPEN\") {\n      await req.context.models.cart.update(\n        {\n          cart_status: cart_status,\n        },\n        { returning: true, where: { cart_id: parseInt(cart_id) } }\n      );\n    } else {\n      await req.context.models.cart.update(\n        {\n          cart_status: \"CLOSED\",\n        },\n        { returning: true, where: { cart_id: parseInt(cart_id) } }\n      );\n    }\n    res.send({ message: \"data has been update\" });\n  } catch (error) {\n    res.status(404).json({ message: error.message });\n  }\n};\n\nconst summaryCart = async (req, res, next) => {\n  const { cart_id } = req.body;\n\n  try {\n    const result = await req.context.models.line_items.findAll({\n      where: { lite_cart_id: cart_id },\n    });\n\n    const lineItems = result;\n    const totalQty = lineItems.reduce((total, el) => total + el.lite_qty, 0);\n    const subTotal = lineItems.reduce(\n      (total, el) => total + parseFloat(el.lite_subtotal),\n      0\n    );\n\n    req.summaryCart = {\n      summary: {\n        totalQty: totalQty,\n        subTotal: subTotal,\n      },\n    };\n    next();\n  } catch (error) {\n    res.status(404).json({ message: error.message });\n  }\n};\n\nconst findAllRows = async (req, res, next) => {\n  try {\n    const result = await req.context.models.cart.findAll();\n    return res.send(result);\n  } catch (error) {\n    return res.send(error);\n  }\n};\n\n\nexport default {\n  isCartOpen,\n  saveLineItem,\n  checkout,\n  updateCart,\n  summaryCart,\n  checkoutMultiple,\n  updateItems,\n  findAllRows\n};\n"],"file":"CartController.js"}